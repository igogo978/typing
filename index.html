<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
    <link href="css/metro.css" rel="stylesheet">
    <link href="css/metro-icons.css" rel="stylesheet">
    <link href="css/metro-responsive.css" rel="stylesheet">
    <script src="js/vue.js"></script>
    <script src="js/vue-resource.min.js"></script>
</head>

<body class="bg-grayLighter fg-grayLighter">
    <div class="container" id='app'>
        <div class="row">
            <div class="col-xs-10 col-md-10" style="height: 50px;">
                <h3>
                    <div>

                            <span class="tag tag-pill tag-info bg-darkCobalt fg-white">
                                計時: <!-- {{countDownTime}} -->
                            </span>

                            <div class="pull-right">
                                <span class="tag tag-pill tag-info">
                                    得分:  <!-- {{totalScores}} --> 
                                </span>
                                <span class="tag tag-pill tag-info">
                                    速度: <!-- {{typingRate}}  --> 字/分
                                </span>
                            </div>

                    </div>

                </h3>
            </div>
        </div>
        <div class="col-xs-10 col-md-10 bg-black padding10 block-shadow" style="border:solid 2px gray; border-radius: 5px;">
            <div class="panel">
                <div class="heading bg-darkBlue fg-grayLighter" style="font-family:DFKai-sb,標楷體;">
                    中文打字練習
                </div>
            </div>
            <span style="font-family:DFKai-sb,標楷體;">
                {{focusArticle}}
            </span>
            <br/>
            <br/>
            <textarea v-bind:class="{ 'bg-dark':isEditable, 'fg-white':isEditable, 'bg-gray':!isEditable }"  v-bind:value="inputText" v-on:input="inputText = $event.target.value" :disabled="!isEditable" @keyup.enter="nextLine" style="width: 97%; height: 50px; resize: none; boarder:solid 1px gray;">
            </textarea>
        </div>
    </div>
    <!-- end of #app -->
    <footer>
        <script>
        "use strict";

        var vm = new Vue({
            el: "#app",
            data: {
                inputText: null,
                article: null,
                focusArticle: null,
                focusLineCollect: [],
                currentLine: 0,
                lineLength: 40,
                isEditable: true,
            },
            created: function() {
                this.fetchData();
                console.log('created');
            },
            mounted: function() {
                console.log('mounted');

            },
            watch: {
                article: function(val, oldVal) {
                    // console.log('new: %s, old: %s', val, oldVal)
                    this.article = val;
                    // console.log('watch');
                    if (this.article.length > 0) {
                        for (let i = 0; i < Math.ceil(this.article.length / this.lineLength); i++) {
                            let obj = {
                                str: String,
                                scores: 0
                            }

                            obj.str = this.article.slice(i * this.lineLength, (i * this.lineLength) + this.lineLength);
                            // console.log(obj.str)
                                // console.log(this.focusLineObj.str);

                            obj.scores = 0;
                            this.focusLineCollect.push(obj);

                        }
                        this.focusArticle = this.focusLineCollect[0].str;

                    }
                }

            },
            computed: {},
            methods: {
                fetchData: function() {
                    this.$http.get('data.php').then(response => {
                        this.article = response.data.article;
                    });

                },
                nextLine: function() {
                        this.currentLine++;
                    if (this.currentLine < this.focusLineCollect.length) {
                        console.log(this.currentLine);
                        this.focusArticle = this.focusLineCollect[this.currentLine].str;
                        this.input = '';
                    } else {
                        this.isEditable = false;
                    }

                },
            }
        });
        </script>
    </footer>
</body>

</html>
